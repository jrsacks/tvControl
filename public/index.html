<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="css/jquery.mobile-1.4.0.min.css" />
<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/jquery.mobile-1.4.0.min.js"></script>
<style>
.show {
  font-size: 10px;
  padding-left: 10px;
}
</style>
</head>
<body>
<div data-role="tabs">
  <div data-role="navbar">
    <ul>
      <li><a href="#channels" data-theme="a" data-ajax="false">Channels</a></li>
      <li><a href="#guide" data-theme="a" data-ajax="false">Guide</a></li>
      <li><a href="#playback" data-theme="a" data-ajax="false">Playback</a></li>
    </ul>
  </div>
  <div id="channels" class="ui-content">
    <ul data-role="listview" data-inset="true">
      <li class="ui-btn" data-route="/tivo/ch/602" data-channel=602>CBS<span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/605" data-channel=605>NBC<span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/607" data-channel=607>ABC<span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/609" data-channel=609>WGN<span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/612" data-channel=612>FOX<span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/681" data-channel=681>ESPN<span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/682" data-channel=682>ESPN2<span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/685" data-channel=685>CSN<span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/686" data-channel=686>BTN<span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/692" data-channel=692>TTC<span class="show"></span></li>
    </ul>
  </div>
  <div id="guide" class="ui-content">
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/TELEPORT/TIVO">TiVo</a></div>
      <div class="ui-block-b"></div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/TELEPORT/LIVETV">Live</a></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/TELEPORT/GUIDE">Guide</a></div>
      <div class="ui-block-b">
        <input type="number" data-clear-btn="true" name="number-4" pattern="[0-9]*" id="number" value="">
      </div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/INFO">Info</a></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/UP">Up</a></div>
      <div class="ui-block-c"></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/LEFT">Left</a></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/SELECT">Select</a></div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/RIGHT">Right</a></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/DOWN">Down</a></div>
      <div class="ui-block-c"></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/CLEAR">Clear</a></div>
      <div class="ui-block-b"></div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/ENTER">Enter</a></div>
    </div>
  </div>
  <div id="playback" class="ui-content">
    <div class="ui-grid-b">
      <div class="ui-block-a"></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/PLAY">Play</a></div>
      <div class="ui-block-c"></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/REVERSE">RW</a></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/PAUSE">Pause</a></div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/FORWARD">FF</a></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/REPLAY">Back</a></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/SLOW">Slow</a></div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/ADVANCE">Skip</a></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-btn-inline ui-shadow ui-corner-all" data-route="/tivo/IRCODE/RECORD">Record</a></div>
      <div class="ui-block-c"></div>
    </div>
  </div>
</div>
<div class="ui-grid-b">
  <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tv/volume/down">Vol -</a></div>
  <div class="ui-block-b"></div>
  <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tv/volume/up">Vol +</a></div>
</div>
<div class="ui-grid-b">
  <div class="ui-block-a"></div>
  <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tv/power/off">TV Off</a></div>
  <div class="ui-block-c"></div>
</div>
<script type="text/javascript">
$(document).ready(function(){
  $('#number').change(function(){
    $.get("/tivo/ch/" + $(this).val());
    $(this).val('');
  });
  $('.ui-btn').click(function(){
    if($(this).data('route')){
      $.get($(this).data('route'));
    }
  });
  
  function updateGuide(){
    var now = new Date().getTime();
    $.getJSON('/guide', function(guide){ 
      $.each(guide, function(idx, data){ 
        $.each(data.shows, function(idx, show){
          if(show.start - now < (5 * 1000 * 60)){
            $($("[data-channel=" + data.channel + "]")[0]).find('.show').text(show.title);
          }
        });
      });
    });
  }
  updateGuide();
  setInterval(updateGuide, 1000*60);
});
</script>
</body>
</html>
