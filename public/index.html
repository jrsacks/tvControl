<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="css/jquery.mobile-1.4.0.min.css" />
<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/jquery.mobile-1.4.0.min.js"></script>
<style>
.show {
  display: inline-block;
  font-size: 10px;
  padding-left: 10px;
}
.station {
  display: inline-block;
  width: 50px;
}
#moreChannels, #channels {
  padding: 0;
}
#moreChannels li, #channels li{
  line-height: 1.1;
}
.vol, #channels ul {
  margin-bottom: 0;
}
</style>
</head>
<body>
<div data-role="tabs">
  <div data-role="navbar">
    <ul>
      <li><a href="#channels" data-theme="a" data-ajax="false">Main</a></li>
      <li><a href="#moreChannels" data-theme="a" data-ajax="false">More</a></li>
      <li><a href="#guide" data-theme="a" data-ajax="false">Guide</a></li>
      <li><a href="#playback" data-theme="a" data-ajax="false">Control</a></li>
    </ul>
  </div>
  <div id="channels" class="ui-content">
    <ul data-role="listview" data-inset="true">
      <li class="ui-btn" data-route="/tivo/ch/602" data-channel=602><div class="station">CBS</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/605" data-channel=605><div class="station">NBC</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/607" data-channel=607><div class="station">ABC</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/609" data-channel=609><div class="station">WGN</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/612" data-channel=612><div class="station">FOX</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/681" data-channel=681><div class="station">ESPN</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/682" data-channel=682><div class="station">ESPN2</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/685" data-channel=685><div class="station">CSN</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/686" data-channel=686><div class="station">BTN</div><span class="show"></span></li>
    </ul>
  </div>
  <div id="moreChannels" class="ui-content">
    <ul data-role="listview" data-inset="true">
      <li class="ui-btn" data-route="/tivo/ch/621" data-channel=621><div class="station">BRAV</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/637" data-channel=637><div class="station">E</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/622" data-channel=622><div class="station">TBS</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/623" data-channel=623><div class="station">TNT</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/624" data-channel=624><div class="station">USA</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/650" data-channel=650><div class="station">CNN</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/660" data-channel=660><div class="station">TRAV</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/692" data-channel=692><div class="station">TENNIS</div><span class="show"></span></li>
      <li class="ui-btn" data-route="/tivo/ch/689" data-channel=689><div class="station">FS1</div><span class="show"></span></li>
    </ul>
  </div>
  <div id="guide" class="ui-content">
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/TELEPORT/TIVO">TiVo</a></div>
      <div class="ui-block-b"></div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/TELEPORT/LIVETV">Live</a></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/TELEPORT/GUIDE">Guide</a></div>
      <div class="ui-block-b">
        <input type="number" data-clear-btn="true" name="number-4" pattern="[0-9]*" id="number" value="">
      </div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/INFO">Info</a></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/UP">Up</a></div>
      <div class="ui-block-c"></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/LEFT">Left</a></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/SELECT">Select</a></div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/RIGHT">Right</a></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/DOWN">Down</a></div>
      <div class="ui-block-c"></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/CLEAR">Clear</a></div>
      <div class="ui-block-b"></div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/ENTER">Enter</a></div>
    </div>
  </div>
  <div id="playback" class="ui-content">
    <div class="ui-grid-b">
      <div class="ui-block-a"></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/PLAY">Play</a></div>
      <div class="ui-block-c"></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/REVERSE">RW</a></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/PAUSE">Pause</a></div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/FORWARD">FF</a></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/REPLAY">Back</a></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/SLOW">Slow</a></div>
      <div class="ui-block-c"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/ADVANCE">Skip</a></div>
    </div>
    <div class="ui-grid-b">
      <div class="ui-block-a"></div>
      <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tivo/IRCODE/RECORD">Rec</a></div>
      <div class="ui-block-c"></div>
    </div>
  </div>
</div>
<div class="ui-grid-b">
  <div class="ui-block-a"><a href="#" class="vol ui-btn ui-shadow ui-corner-all" data-route="/tv/volume/down">Vol -</a></div>
  <div class="ui-block-b"><a href="#" class="ui-btn ui-shadow ui-corner-all" data-route="/tv/power/off">TV Off</a></div>
  <div class="ui-block-c"><a href="#" class="vol ui-btn ui-shadow ui-corner-all" data-route="/tv/volume/up">Vol +</a></div>
</div>
<div class="ui-grid-b">
  <div class="ui-block-a"></div>
  <div class="ui-block-c"></div>
</div>
<script type="text/javascript">
$(document).ready(function(){
  setTimeout(function(){ window.scrollTo(0,1);}, 1); //get rid of address bar0
  $('#number').change(function(){
    $.get("/tivo/ch/" + $(this).val());
    $(this).val('');
  });
  $('.ui-btn').click(function(){
    if($(this).data('route')){
      $.get($(this).data('route'));
    }
  });
  
  function displayShow(show){
    var start = new Date(show.start);
    var hour = start.getHours();
    if (hour > 12){
      hour = hour % 12;
    }
    var minute = start.getMinutes();
    if (minute === 0){
      minute = "00";
    }
    return  hour + ":" + minute + " " + show.title;
  }

  function updateGuide(){
    var now = new Date().getTime();
    $.getJSON('/guide', function(guide){ 
      $.each(guide, function(idx, data){ 
        $.each(data.shows, function(idx, show){
          if(show.start - now < (5 * 1000 * 60)){
            var showElem = $($("[data-channel=" + data.channel + "]")[0]).find('.show');
            showElem.empty();
            if(idx < data.shows.length - 1){
              showElem.append($('<div>').text(displayShow(show)));
              showElem.append($('<div>').text(displayShow(data.shows[idx + 1])));
            } else {
              showElem.text(displayShow(show));
            }
          }
        });
      });
    });
  }
  updateGuide();
  setInterval(updateGuide, 1000*60);
});
</script>
</body>
</html>
